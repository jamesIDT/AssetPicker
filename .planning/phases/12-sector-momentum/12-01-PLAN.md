---
phase: 12-sector-momentum
plan: 01
type: execute
---

<objective>
Create a Sector Momentum View that visualizes sector rotation and identifies sectors at inflection points.

Purpose: Enable detection of sector rotation opportunities - sectors that are oversold AND showing positive momentum are prime candidates for rotation trades.
Output: New expander section with sector bar chart, momentum indicators, rotation signals, and drill-down filtering.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context
@.planning/phases/07-data-layer-extensions/07-03-SUMMARY.md (sector classification)
@.planning/phases/11-signal-lifecycle/11-01-SUMMARY.md (expander UI pattern)

# Key source files
@src/sectors.py (calculate_sector_rsi, SECTOR_MAPPINGS)
@app.py (main UI, expander pattern from lifecycle analysis)

**Tech stack available:** Streamlit, Plotly, pandas (imported in lifecycle section)

**Established patterns:**
- st.expander for collapsible sections (Phase 11)
- Plotly charts with custom styling (Phase 4, 10)
- Market-cap weighted sector RSI calculation (Phase 7-03)

**From prior phases:**
- Phase 7-03: Sector classification with SECTOR_MAPPINGS covering L1, DeFi, AI, Gaming, Meme, Infra
- Phase 11: Expander UI pattern with dataframe display
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend sectors.py with momentum and history tracking</name>
  <files>src/sectors.py</files>
  <action>
Add function `calculate_sector_momentum()` that takes a list of coin dicts with RSI history and returns per-sector:
- current_rsi: Current weighted RSI (reuse existing logic)
- rsi_7d_ago: RSI from 7 days ago
- momentum: "rising" | "falling" | "flat" based on 7d change (threshold: 3 points)
- momentum_arrow: "â†—" | "â†˜" | "â†’"
- change_7d: Numeric change
- is_rotation_signal: True if RSI < 35 AND change_7d > 0
- days_since_bottom: Days since sector's lowest RSI in last 30 days

Input coins need: id, daily_rsi, market_cap, rsi_history (list of last 30 daily RSI values).

Use market-cap weighted average for historical RSI same as current. Handle missing history gracefully (return None for momentum fields if insufficient data).
  </action>
  <verify>python -c "from src.sectors import calculate_sector_momentum; print('Import OK')"</verify>
  <done>Function exists, handles edge cases, returns all specified fields per sector</done>
</task>

<task type="auto">
  <name>Task 2: Add Sector Momentum expander with bar chart</name>
  <files>app.py</files>
  <action>
Add new expander "ðŸ“Š Sector Momentum" after the Signal Lifecycle Analysis section.

Inside expander:
1. Call calculate_sector_momentum() with coin data (need to add rsi_history to coin dicts during fetch)
2. Build Plotly horizontal bar chart:
   - Y-axis: Sector names (sorted by RSI ascending - most oversold at top)
   - X-axis: Current RSI (0-100 scale)
   - Color: Green for RSI < 35, Yellow for 35-65, Red for > 65
   - Annotations: Add momentum arrow next to each bar
   - Add vertical line at x=50 (neutral)
3. Display rotation signals prominently:
   - If any sector is_rotation_signal, show info box: "ðŸ”„ Rotation signals: {sector names}"
4. Show data table with columns: Sector, RSI, 7D Î”, Momentum, Days Since Bottom, Coins
5. Add drill-down: st.selectbox to choose sector, filter main scatter to just those coins

Data flow: Need to extend fetch_all_data to include rsi_history for each coin. Pass it to calculate_sector_momentum().
  </action>
  <verify>Run app, click Refresh, expand Sector Momentum, verify bar chart displays with arrows</verify>
  <done>Expander shows bar chart with momentum arrows, rotation signals box if applicable, data table, and sector filter dropdown</done>
</task>

<task type="auto">
  <name>Task 3: Implement sector drill-down filtering</name>
  <files>app.py</files>
  <action>
Add sector filtering that affects the main scatter chart:
1. At top of chart section (before color mode radio), add st.selectbox:
   - Options: ["All Sectors"] + list of sectors with coin counts
   - Default: "All Sectors"
2. Store selection in session state for persistence
3. Filter coin_data before passing to build_rsi_scatter:
   - If sector selected != "All Sectors", filter to only coins where sector matches
   - Update opportunities/caution lists to respect filter
4. Show filtered count: "{N} coins" next to dropdown

Keep it simple: Just filter the data, don't need to change chart parameters. The chart will render with fewer points.
  </action>
  <verify>Select a sector from dropdown, verify scatter chart shows only coins from that sector</verify>
  <done>Sector dropdown filters main scatter chart and opportunity lists, selection persists across refreshes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python -c "from src.sectors import calculate_sector_momentum"` succeeds
- [ ] App runs without errors with `streamlit run app.py`
- [ ] Sector Momentum expander shows horizontal bar chart
- [ ] Momentum arrows display next to each bar
- [ ] Rotation signals box appears when conditions met
- [ ] Sector filter dropdown works to filter scatter chart
- [ ] Data table shows all sector metrics
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/Python errors
- Sector rotation view provides actionable insights
- Drill-down filtering works bidirectionally
</success_criteria>

<output>
After completion, create `.planning/phases/12-sector-momentum/12-01-SUMMARY.md` following the summary template.
</output>

---
phase: 06-polish
plan: 01
type: execute
---

<objective>
Add loading indicator during data fetch, enhance error handling with specific messages, and refine UI layout.

Purpose: Make the app feel responsive during slow API calls and provide clear feedback when things go wrong.
Output: Production-ready personal screening tool with polished UX.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-interaction-lists/05-01-SUMMARY.md
@app.py
@src/coingecko.py

**Tech stack available:** Python, Streamlit, Plotly, httpx, asyncio
**Established patterns:** Session state for data persistence, asyncio.gather with return_exceptions

**Phase 6 deliverables (from roadmap):**
- Refresh button with loading indicator
- Last updated timestamp display (already exists)
- Error states for API/network failures
- Graceful handling of missing data
- UI refinements per spec layout
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add loading spinner during data fetch</name>
  <files>app.py</files>
  <action>
    Wrap the data fetch call in `st.spinner("Fetching data from CoinGecko...")` context manager to show loading state during the async operation. The spinner displays automatically while the code inside executes.

    Move from:
    ```python
    if st.button("Refresh Data"):
        try:
            data = asyncio.run(fetch_all_data(coin_ids))
    ```

    To:
    ```python
    if st.button("Refresh Data"):
        with st.spinner("Fetching data from CoinGecko..."):
            try:
                data = asyncio.run(fetch_all_data(coin_ids))
    ```
  </action>
  <verify>Run `streamlit run app.py`, click Refresh, observe spinner appears during fetch</verify>
  <done>Spinner visible during API calls, disappears when complete</done>
</task>

<task type="auto">
  <name>Task 2: Enhance error handling with specific messages</name>
  <files>app.py</files>
  <action>
    Improve error handling to distinguish between different failure types:

    1. Catch `FileNotFoundError` for missing watchlist.json and show helpful message
    2. Catch httpx.TimeoutException separately from general CoinGeckoError
    3. Add warning when some coins failed to fetch but others succeeded (partial failure)
    4. Track how many coins succeeded vs failed in fetch_all_data

    Update fetch_all_data to return (data, failed_count) tuple. Show st.warning if failed_count > 0 but data has results.

    Handle watchlist load errors:
    ```python
    try:
        watchlist = load_watchlist()
    except FileNotFoundError:
        st.error("watchlist.json not found. Create it with a 'coins' array.")
        st.stop()
    except json.JSONDecodeError as e:
        st.error(f"Invalid JSON in watchlist.json: {e}")
        st.stop()
    ```

    Show partial failure warning after fetch:
    ```python
    data, failed_count = asyncio.run(fetch_all_data(coin_ids))
    if failed_count > 0:
        st.warning(f"Could not fetch data for {failed_count} coin(s)")
    ```
  </action>
  <verify>Test by: (1) renaming watchlist.json temporarily - should show error, (2) adding invalid coin ID to watchlist - should show partial warning</verify>
  <done>Specific error messages for missing watchlist, invalid JSON, and partial API failures</done>
</task>

<task type="auto">
  <name>Task 3: UI refinements and missing data handling</name>
  <files>app.py</files>
  <action>
    Polish the UI layout and handle edge cases:

    1. Add subtitle with data source attribution: `st.caption("Data from CoinGecko Pro API")`
    2. Move timestamp to a more prominent location (above chart, right-aligned)
    3. Add empty state for lists when coin_data exists but has 0 items
    4. Add count of coins in header: `st.title(f"Crypto RSI Screener ({len(coin_ids)} coins)")`
    5. Show coin count in each list header: `st.subheader(f"... ({len(opportunities)})")`

    Layout change for timestamp:
    ```python
    # Before chart
    if st.session_state.last_updated:
        st.caption(f"Last updated: {st.session_state.last_updated.strftime('%Y-%m-%d %H:%M:%S')}")
    ```

    Handle zero results gracefully:
    ```python
    if not st.session_state.coin_data:
        st.warning("No valid coin data available. Check your watchlist configuration.")
    ```
  </action>
  <verify>Run app, verify: (1) subtitle appears, (2) timestamp above chart, (3) counts in headers</verify>
  <done>UI shows data source, timestamp prominent, counts in headers, graceful empty states</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `streamlit run app.py` launches without errors
- [ ] Spinner appears during data fetch
- [ ] Specific error message when watchlist.json missing
- [ ] Warning shown when some coins fail to fetch
- [ ] Timestamp displays above chart
- [ ] Coin counts shown in headers
- [ ] Empty state message when no data
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/Python errors
- Loading indicator visible during fetch
- Error messages are specific and actionable
- UI feels polished and informative
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Polish Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `app.py` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Phase complete - all milestone 1 features implemented]
</output>
